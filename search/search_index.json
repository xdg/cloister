{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"command-reference/","title":"Command Reference","text":"<p>Complete reference for all Cloister CLI commands.</p>"},{"location":"command-reference/#global-flags","title":"Global Flags","text":"<p>These flags apply to all commands:</p> Flag Description <code>--help</code>, <code>-h</code> Show help for command <code>--version</code> Show version information"},{"location":"command-reference/#cloister-commands","title":"Cloister Commands","text":""},{"location":"command-reference/#cloister-start","title":"cloister start","text":"<p>Start or enter a cloister for the current project.</p> <pre><code>cloister start [--agent &lt;name&gt;]\n</code></pre> <p>Must be run from within a git repository. Detects the project automatically and starts a sandboxed container with the project mounted at <code>/work</code>.</p> <p>Flags:</p> Flag Description <code>--agent</code> Override the default agent (e.g., <code>claude</code>, <code>codex</code>) <p>Behavior: - If no cloister exists, creates one and attaches an interactive shell - If a cloister already exists, attaches to it - The guardian proxy auto-starts if not running - Agent selection: CLI flag &gt; config default &gt; \"claude\"</p> <p>Examples: <pre><code># Start cloister for current directory (uses default agent)\ncd ~/projects/my-app\ncloister start\n\n# Start with a specific agent\ncloister start --agent codex\n</code></pre></p>"},{"location":"command-reference/#cloister-stop","title":"cloister stop","text":"<p>Stop and remove a cloister.</p> <pre><code>cloister stop [name]\n</code></pre> <p>Arguments: - <code>name</code> \u2014 Cloister name (optional, defaults to current project)</p> <p>Examples: <pre><code># Stop cloister for current directory\ncloister stop\n\n# Stop specific cloister\ncloister stop my-app\n</code></pre></p>"},{"location":"command-reference/#cloister-list","title":"cloister list","text":"<p>List running cloisters.</p> <pre><code>cloister list\n</code></pre> <p>Aliases: <code>ls</code></p> <p>Output columns: - <code>NAME</code> \u2014 Cloister name - <code>PROJECT</code> \u2014 Project name - <code>BRANCH</code> \u2014 Git branch - <code>UPTIME</code> \u2014 Time since start - <code>STATUS</code> \u2014 running/stopped</p> <p>Example output: <pre><code>NAME      PROJECT    BRANCH    UPTIME    STATUS\nmy-app    my-app     main      2h 15m    running\n</code></pre></p>"},{"location":"command-reference/#guardian-commands","title":"Guardian Commands","text":""},{"location":"command-reference/#cloister-guardian-start","title":"cloister guardian start","text":"<p>Start the guardian daemon.</p> <pre><code>cloister guardian start\n</code></pre> <p>Usually not needed \u2014 the guardian auto-starts on first <code>cloister start</code>.</p>"},{"location":"command-reference/#cloister-guardian-stop","title":"cloister guardian stop","text":"<p>Stop the guardian and all cloisters.</p> <pre><code>cloister guardian stop\n</code></pre> <p>Warns if there are running cloister containers that will lose network access.</p>"},{"location":"command-reference/#cloister-guardian-status","title":"cloister guardian status","text":"<p>Show guardian status.</p> <pre><code>cloister guardian status\n</code></pre> <p>Output: <pre><code>Status: running\nUptime: 2 hours, 15 minutes\nActive tokens: 2\nExecutor: running (PID 12345)\n</code></pre></p>"},{"location":"command-reference/#project-commands","title":"Project Commands","text":""},{"location":"command-reference/#cloister-project-list","title":"cloister project list","text":"<p>List registered projects.</p> <pre><code>cloister project list\n</code></pre>"},{"location":"command-reference/#cloister-project-show","title":"cloister project show","text":"<p>Show project details.</p> <pre><code>cloister project show &lt;name&gt;\n</code></pre>"},{"location":"command-reference/#cloister-project-edit","title":"cloister project edit","text":"<p>Open project config in <code>$EDITOR</code>.</p> <pre><code>cloister project edit &lt;name&gt;\n</code></pre>"},{"location":"command-reference/#cloister-project-remove","title":"cloister project remove","text":"<p>Remove project registration.</p> <pre><code>cloister project remove &lt;name&gt;\n</code></pre> <p>Does not delete project files, only the Cloister registration.</p>"},{"location":"command-reference/#configuration-commands","title":"Configuration Commands","text":""},{"location":"command-reference/#cloister-config-show","title":"cloister config show","text":"<p>Display effective configuration.</p> <pre><code>cloister config show\n</code></pre>"},{"location":"command-reference/#cloister-config-edit","title":"cloister config edit","text":"<p>Edit global configuration file in <code>$EDITOR</code>.</p> <pre><code>cloister config edit\n</code></pre>"},{"location":"command-reference/#cloister-config-path","title":"cloister config path","text":"<p>Show the path to the global configuration file.</p> <pre><code>cloister config path\n</code></pre>"},{"location":"command-reference/#cloister-config-init","title":"cloister config init","text":"<p>Create a default configuration file if one doesn't exist.</p> <pre><code>cloister config init\n</code></pre>"},{"location":"command-reference/#setup-commands","title":"Setup Commands","text":""},{"location":"command-reference/#cloister-setup-claude","title":"cloister setup claude","text":"<p>Configure Claude Code credentials for use in cloisters.</p> <pre><code>cloister setup claude\n</code></pre> <p>Runs an interactive wizard that offers two authentication methods: 1. Long-lived OAuth token (from <code>claude setup-token</code>) 2. API key (from console.anthropic.com)</p>"},{"location":"command-reference/#cloister-setup-codex","title":"cloister setup codex","text":"<p>Configure Codex CLI credentials for use in cloisters.</p> <pre><code>cloister setup codex\n</code></pre> <p>Runs an interactive wizard that prompts for: 1. OpenAI API key (from platform.openai.com/api-keys) 2. Full-auto mode preference (default: enabled)</p>"},{"location":"command-reference/#exit-codes","title":"Exit Codes","text":"Code Meaning 0 Success 1 General error 2 Invalid arguments"},{"location":"command-reference/#environment-variables","title":"Environment Variables","text":"Variable Description <code>EDITOR</code> Editor for <code>config edit</code> and <code>project edit</code> commands"},{"location":"command-reference/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration \u2014 Config file format</li> <li>Troubleshooting \u2014 Common issues</li> </ul>"},{"location":"configuration/","title":"Configuration","text":"<p>Cloister uses YAML configuration files to control network allowlists, hostexec patterns, and default behaviors.</p>"},{"location":"configuration/#configuration-file-locations","title":"Configuration File Locations","text":"File Purpose <code>~/.config/cloister/config.yaml</code> Global defaults <code>~/.config/cloister/projects/&lt;name&gt;.yaml</code> Per-project overrides <code>~/.config/cloister/decisions/global.yaml</code> Globally approved/denied domains (from web UI) <code>~/.config/cloister/decisions/projects/&lt;name&gt;.yaml</code> Per-project approved/denied domains (from web UI)"},{"location":"configuration/#global-configuration","title":"Global Configuration","text":"<p>The global config applies to all cloisters unless overridden by project config.</p> <pre><code># ~/.config/cloister/config.yaml\n\n# Default agent (claude or codex)\ndefaults:\n  agent: claude  # or \"codex\"\n\n# Network allowlist (applied to all projects)\nproxy:\n  allow:\n    - domain: api.anthropic.com\n    - domain: api.openai.com\n    - domain: registry.npmjs.org\n    - domain: proxy.golang.org\n  # Options: \"reject\" or \"request_approval\"\n  unlisted_domain_behavior: request_approval\n\n# Hostexec patterns\nhostexec:\n  # Commands matching these patterns auto-approve\n  auto_approve:\n    - pattern: \"^go mod tidy$\"\n    - pattern: \"^npm install$\"\n  # Commands matching these patterns require manual approval\n  manual_approve:\n    - pattern: \"^docker compose\"\n</code></pre>"},{"location":"configuration/#per-project-configuration","title":"Per-Project Configuration","text":"<p>Project configs override or extend global settings:</p> <pre><code># ~/.config/cloister/projects/my-api.yaml\n\n# Additional allowed domains for this project\nproxy:\n  allow:\n    - domain: docs.example.com\n    - domain: internal-registry.company.com\n\n# Project-specific command patterns\nhostexec:\n  auto_approve:\n    - pattern: \"^docker compose up\"\n    - pattern: \"^docker compose down\"\n</code></pre>"},{"location":"configuration/#using-the-config-command","title":"Using the Config Command","text":"<pre><code># Show current effective config\ncloister config show\n\n# Edit global config in $EDITOR\ncloister config edit\n\n# Edit project config\ncloister project edit my-api\n</code></pre>"},{"location":"configuration/#network-allowlist","title":"Network Allowlist","text":"<p>The allowlist controls which domains containers can reach through the guardian proxy.</p>"},{"location":"configuration/#default-allowlist","title":"Default Allowlist","text":"<p>Cloister includes sensible defaults for common development: - AI provider APIs (Anthropic, OpenAI) - Package registries (npm, PyPI, Go proxy, crates.io) - Documentation sites (Go docs, etc.)</p>"},{"location":"configuration/#adding-domains","title":"Adding Domains","text":"<pre><code>proxy:\n  allow:\n    # Exact domain\n    - domain: docs.example.com\n    # Each domain needs its own entry\n    - domain: api.example.com\n</code></pre>"},{"location":"configuration/#approved-domains","title":"Approved Domains","text":"<p>Domains approved or denied via the web UI are stored separately from static config files:</p> <pre><code>~/.config/cloister/decisions/\n\u251c\u2500\u2500 global.yaml                # Globally approved/denied domains\n\u2514\u2500\u2500 projects/\n    \u2514\u2500\u2500 my-api.yaml            # Per-project approved/denied domains\n</code></pre> <p>This separation ensures the guardian container only has write access to decision data, not your static configuration. At load time, static config and decision files are merged automatically.</p> <p>Decision file format: <pre><code># Example: ~/.config/cloister/decisions/projects/my-api.yaml\nproxy:\n  allow:\n    - domain: docs.example.com\n    - domain: internal-api.company.com\n    - pattern: \"*.cdn.example.com\"\n  deny:\n    - domain: known-bad-site.example.com\n</code></pre></p> <p>To consolidate decisions into static config, move entries from a decision file into the corresponding config file (e.g., from <code>decisions/global.yaml</code> into <code>config.yaml</code>), then delete the decision file.</p>"},{"location":"configuration/#unlisted-domain-behavior","title":"Unlisted Domain Behavior","text":"<p>When a request is made to an unlisted domain:</p> <pre><code>proxy:\n  # Options: \"reject\" or \"request_approval\"\n  unlisted_domain_behavior: reject\n</code></pre> <p>With <code>request_approval</code>, the connection is held while a request appears in the approval UI.</p>"},{"location":"configuration/#hostexec-patterns","title":"Hostexec Patterns","text":"<p>Hostexec patterns use Go regular expressions to match command strings.</p>"},{"location":"configuration/#pattern-matching","title":"Pattern Matching","text":"<pre><code>hostexec:\n  auto_approve:\n    # Exact command only\n    - pattern: \"^go mod tidy$\"\n\n    # Command with any arguments\n    - pattern: \"^npm install\"\n\n    # Specific subcommands\n    - pattern: \"^docker compose (up|down|ps)\"\n\n  manual_approve:\n    # Commands that need human review\n    - pattern: \"^git push\"\n    - pattern: \"^rm -rf\"\n</code></pre> <p>Commands not matching any pattern are denied by default.</p>"},{"location":"configuration/#agent-configuration","title":"Agent Configuration","text":"<p>See Credentials for agent-specific authentication setup.</p>"},{"location":"configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Host Commands \u2014 How hostexec works</li> <li>Command Reference \u2014 Full CLI documentation</li> </ul>"},{"location":"credentials/","title":"Credentials","text":"<p>Cloister needs AI agent credentials to run tools like Claude Code inside containers. This guide covers authentication setup for supported agents.</p>"},{"location":"credentials/#claude-code","title":"Claude Code","text":"<p>Claude Code supports three authentication methods. Cloister's setup wizard handles the configuration.</p>"},{"location":"credentials/#running-the-setup-wizard","title":"Running the Setup Wizard","text":"<pre><code>cloister setup claude\n</code></pre> <p>The wizard will: 1. Detect any existing Claude authentication on the host 2. Present a menu of authentication methods 3. Store credentials in config 4. Configure injection for container startup</p>"},{"location":"credentials/#authentication-methods","title":"Authentication Methods","text":""},{"location":"credentials/#1-oauth-token-recommended-for-promax","title":"1. OAuth Token (Recommended for Pro/Max)","text":"<p>Best for Claude Pro or Max subscribers:</p> <pre><code># First, get a token from Claude Code CLI\nclaude setup-token\n# This opens a browser for OAuth and displays a token\n\n# Then configure Cloister\ncloister setup claude\n# Choose \"Long-lived OAuth token\" and paste the token\n</code></pre> <p>Tokens are valid for approximately one year.</p>"},{"location":"credentials/#2-existing-login-session","title":"2. Existing Login Session","text":"<p>If you're already logged into Claude Code on the host:</p> <pre><code>cloister setup claude\n# Choose \"Use existing login\"\n</code></pre> <p>Cloister extracts credentials and injects them into the container at startup.</p> <p>Note: Session files may expire. Use OAuth tokens for long-running setups.</p>"},{"location":"credentials/#3-api-key","title":"3. API Key","text":"<p>For API access (requires Anthropic API account):</p> <pre><code>cloister setup claude\n# Choose \"API key\"\n# Paste your sk-ant-... key\n</code></pre> <p>API usage is billed separately from Claude Pro/Max subscriptions.</p>"},{"location":"credentials/#credential-storage","title":"Credential Storage","text":"<p>Credentials are stored in the global config file:</p> <pre><code>~/.config/cloister/\n\u2514\u2500\u2500 config.yaml          # Contains agent credentials under agents.claude\n</code></pre> <p>Example config structure:</p> <pre><code>agents:\n  claude:\n    auth_method: token  # or \"existing\" or \"api_key\"\n    token: \"...\"        # if using OAuth token\n    api_key: \"...\"      # if using API key\n</code></pre>"},{"location":"credentials/#security-notes","title":"Security Notes","text":"<ul> <li>Host credential files (<code>~/.anthropic/</code>, <code>~/.claude/</code>) are not bind-mounted into containers</li> <li>For \"existing\" auth, credentials are extracted and written into the container at startup</li> <li>For token/API key auth, values are injected via environment or config files</li> <li>Config file permissions should be restricted (readable only by owner)</li> </ul>"},{"location":"credentials/#container-environment","title":"Container Environment","text":"<p>Inside the cloister, Claude Code is pre-configured:</p> <pre><code>cloister@container:/work$ claude --version\n# Claude Code runs with injected credentials\n</code></pre> <p>By default, Claude is aliased to include <code>--dangerously-skip-permissions</code> since the sandbox provides containment.</p>"},{"location":"credentials/#disabling-the-alias","title":"Disabling the Alias","text":"<p>If you prefer Claude's normal permission prompts inside the cloister:</p> <pre><code># ~/.config/cloister/config.yaml\nagents:\n  claude:\n    skip_permissions: false\n</code></pre>"},{"location":"credentials/#refreshing-credentials","title":"Refreshing Credentials","text":"<p>To update credentials (e.g., after token expiration):</p> <pre><code>cloister setup claude\n# Re-run the wizard\n</code></pre> <p>For running cloisters, restart to pick up new credentials:</p> <pre><code>cloister stop my-app\ncloister start\n</code></pre>"},{"location":"credentials/#codex-cli","title":"Codex CLI","text":"<p>Codex CLI uses OpenAI API key authentication.</p>"},{"location":"credentials/#running-the-setup-wizard_1","title":"Running the Setup Wizard","text":"<pre><code>cloister setup codex\n</code></pre> <p>The wizard will: 1. Prompt for your OpenAI API key 2. Ask about full-auto mode preference 3. Store credentials in config 4. Configure injection for container startup</p>"},{"location":"credentials/#authentication","title":"Authentication","text":"<p>Get your API key from platform.openai.com/api-keys:</p> <pre><code>cloister setup codex\n# Paste your sk-... key when prompted\n</code></pre> <p>API key is stored in <code>~/.config/cloister/config.yaml</code> under <code>agents.codex.api_key</code> and injected via <code>OPENAI_API_KEY</code> env var.</p>"},{"location":"credentials/#credential-storage_1","title":"Credential Storage","text":"<pre><code>agents:\n  codex:\n    api_key: \"sk-...\"\n    skip_permissions: true  # enables full-auto mode\n</code></pre>"},{"location":"credentials/#container-environment_1","title":"Container Environment","text":"<p>Inside the cloister, Codex CLI is pre-configured:</p> <pre><code>cloister@container:/work$ codex --version\n# Codex runs with injected credentials\n</code></pre> <p>By default, Codex is aliased to include <code>--approval-mode full-auto</code> since the sandbox provides containment.</p>"},{"location":"credentials/#disabling-full-auto-mode","title":"Disabling Full-Auto Mode","text":"<p>If you prefer Codex's normal approval prompts inside the cloister:</p> <pre><code># ~/.config/cloister/config.yaml\nagents:\n  codex:\n    skip_permissions: false\n</code></pre>"},{"location":"credentials/#refreshing-credentials_1","title":"Refreshing Credentials","text":"<p>To update credentials:</p> <pre><code>cloister setup codex\n# Re-run the wizard\n</code></pre> <p>For running cloisters, restart to pick up new credentials:</p> <pre><code>cloister stop my-app\ncloister start\n</code></pre>"},{"location":"credentials/#other-agents","title":"Other Agents","text":"<p>Support for additional AI coding agents is planned:</p> <ul> <li>Gemini CLI \u2014 Coming soon</li> </ul> <p>The setup pattern is the same:</p> <pre><code>cloister setup &lt;agent&gt;\n</code></pre>"},{"location":"credentials/#troubleshooting","title":"Troubleshooting","text":""},{"location":"credentials/#claude-authentication-failed-inside-cloister","title":"Claude: \"Authentication failed\" inside cloister","text":"<ol> <li>Verify credentials are configured: <code>cloister setup claude</code></li> <li>Check token hasn't expired (OAuth tokens last ~1 year)</li> <li>Restart the cloister after updating credentials</li> </ol>"},{"location":"credentials/#claude-prompts-for-login-inside-container","title":"Claude prompts for login inside container","text":"<p>The credential injection may have failed. Re-run setup:</p> <pre><code>cloister setup claude\ncloister stop\ncloister start\n</code></pre>"},{"location":"credentials/#codex-authentication-failed-inside-cloister","title":"Codex: \"Authentication failed\" inside cloister","text":"<ol> <li>Verify credentials are configured: <code>cloister setup codex</code></li> <li>Verify API key is valid at platform.openai.com</li> <li>Restart the cloister after updating credentials</li> </ol>"},{"location":"credentials/#codex-prompts-for-api-key-inside-container","title":"Codex prompts for API key inside container","text":"<p>The credential injection may have failed. Re-run setup:</p> <pre><code>cloister setup codex\ncloister stop\ncloister start\n</code></pre>"},{"location":"credentials/#next-steps","title":"Next Steps","text":"<ul> <li>Getting Started \u2014 First cloister walkthrough</li> <li>Configuration \u2014 Global and per-project settings</li> </ul>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This guide walks you through installing Cloister and running your first sandboxed AI agent session.</p>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker (or OrbStack on macOS) \u2014 Cloister runs containers on an isolated network</li> <li>A git repository \u2014 Cloister is designed for project-based workflows</li> </ul>"},{"location":"getting-started/#installation","title":"Installation","text":""},{"location":"getting-started/#recommended-install-script","title":"Recommended: Install Script","text":"<pre><code>curl -fsSL https://raw.githubusercontent.com/xdg/cloister/main/install.sh | sh\n</code></pre> <p>This downloads the latest release and installs it to <code>~/.local/bin</code>. If this directory isn't already in your PATH, the script will offer to add it to your shell configuration (bash, zsh, or fish).</p> <p>To install a specific version:</p> <pre><code>VERSION=v1.0.0 curl -fsSL https://raw.githubusercontent.com/xdg/cloister/main/install.sh | sh\n</code></pre>"},{"location":"getting-started/#alternative-build-from-source","title":"Alternative: Build from Source","text":"<p>Requires Go 1.25+.</p> <pre><code>go install github.com/xdg/cloister/cmd/cloister@latest\n</code></pre> <p>Or clone and build manually:</p> <pre><code>git clone https://github.com/xdg/cloister.git\ncd cloister\nmake build\n# Binary is at ./cloister\n</code></pre>"},{"location":"getting-started/#first-time-setup","title":"First-Time Setup","text":"<p>Before using Cloister, configure your AI agent credentials.</p> <p>For Claude Code:</p> <pre><code>cloister setup claude\n</code></pre> <p>The setup wizard prompts for authentication method (OAuth token or API key).</p> <p>For Codex CLI:</p> <pre><code>cloister setup codex\n</code></pre> <p>The setup wizard prompts for your OpenAI API key.</p> <p>See Credentials for details on each method.</p>"},{"location":"getting-started/#your-first-cloister","title":"Your First Cloister","text":"<p>Navigate to any git repository and start a cloister:</p> <pre><code>cd ~/projects/my-app\ncloister start\n</code></pre> <p>What happens:</p> <ol> <li>The guardian proxy starts automatically (if not running)</li> <li>A container is created on an isolated Docker network</li> <li>Your project directory is mounted at <code>/work</code></li> <li>You're dropped into a shell inside the container</li> </ol> <pre><code>Started cloister: my-app\nProject: my-app (branch: main)\nToken: cloister_abc123...\n\nAttaching interactive shell...\n\ncloister@container:/work$\n</code></pre>"},{"location":"getting-started/#running-your-agent-inside-the-cloister","title":"Running Your Agent Inside the Cloister","text":"<p>Inside the cloister, your configured agent runs with permissions auto-approved \u2014 the sandbox provides the safety net.</p> <p>Claude Code (default):</p> <pre><code>cloister@container:/work$ claude\n</code></pre> <p>Codex CLI:</p> <pre><code>cloister@container:/work$ codex\n</code></pre> <p>To use a different agent than your default, start with <code>--agent</code>:</p> <pre><code>cloister start --agent codex\n</code></pre> <p>Your agent can: - Read and write files in <code>/work</code> (your project) - Access allowlisted domains (AI APIs, package registries, docs) - Request host commands via the approval UI</p>"},{"location":"getting-started/#monitoring-activity","title":"Monitoring Activity","text":"<p>Open http://localhost:9999 in your browser to: - See pending hostexec requests - Approve or deny commands</p>"},{"location":"getting-started/#exiting-and-stopping","title":"Exiting and Stopping","text":"<pre><code># Exit the shell (container keeps running)\ncloister@container:/work$ exit\n\n# Re-enter the running cloister\ncloister start\n\n# Stop and remove the cloister\ncloister stop\n</code></pre> <p>When you exit the shell: <pre><code>Shell exited with code 0. Cloister still running.\nUse 'cloister stop my-app' to terminate.\n</code></pre></p>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration \u2014 Customize allowlists and settings</li> <li>Working with Cloisters \u2014 Managing cloister lifecycle</li> <li>Host Commands \u2014 Using hostexec for git push, docker, etc.</li> </ul>"},{"location":"host-commands/","title":"Host Commands","text":"<p>Cloisters are isolated from the host system. When an AI agent needs to run commands that affect the host (like <code>git push</code> or <code>docker</code>), it uses hostexec \u2014 a controlled escape hatch with human approval.</p>"},{"location":"host-commands/#why-hostexec-exists","title":"Why Hostexec Exists","text":"<p>Inside a cloister: - No SSH keys or git credentials (can't push directly) - No Docker socket (can't manage host containers) - No access to host commands or filesystems</p> <p>This is by design. When legitimate host access is needed, <code>hostexec</code> routes the request through the guardian for approval.</p>"},{"location":"host-commands/#using-hostexec","title":"Using Hostexec","text":"<p>From inside a cloister:</p> <pre><code>cloister@container:/work$ hostexec git push origin main\n</code></pre> <p>What happens: 1. Request sent to guardian 2. Guardian checks auto-approve patterns 3. If no match, request appears in approval UI 4. Human approves or denies 5. Command runs on host (in the project directory) 6. Output returned to container</p>"},{"location":"host-commands/#the-approval-ui","title":"The Approval UI","text":"<p>Open http://localhost:9999 to see pending requests:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Pending Requests                                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  my-app \u2502 git push origin feature-branch                \u2502\n\u2502         \u2502 [Approve] [Deny]                              \u2502\n\u2502                                                          \u2502\n\u2502  frontend \u2502 docker compose up -d                        \u2502\n\u2502           \u2502 [Approve] [Deny]                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"host-commands/#approval-options","title":"Approval Options","text":"<ul> <li>Approve \u2014 Run this command once</li> <li>Deny \u2014 Reject this request</li> </ul>"},{"location":"host-commands/#auto-approve-patterns","title":"Auto-Approve Patterns","text":"<p>Configure patterns to approve automatically without UI interaction:</p> <pre><code># ~/.config/cloister/config.yaml\nhostexec:\n  auto_approve:\n    - pattern: \"^go mod tidy$\"\n    - pattern: \"^npm install$\"\n    - pattern: \"^git status$\"\n    - pattern: \"^git diff\"\n</code></pre> <p>Patterns are Go regular expressions matched against the command string.</p>"},{"location":"host-commands/#pattern-examples","title":"Pattern Examples","text":"<pre><code>hostexec:\n  auto_approve:\n    # Exact command only\n    - pattern: \"^go mod tidy$\"\n\n    # Command with any arguments\n    - pattern: \"^npm install\"\n\n    # Specific docker compose commands\n    - pattern: \"^docker compose (up|down|ps|logs)\"\n\n    # Git operations on specific remote\n    - pattern: \"^git push origin\"\n\n    # Allow any git command (use with caution)\n    - pattern: \"^git \"\n</code></pre>"},{"location":"host-commands/#manual-approve-patterns","title":"Manual Approve Patterns","text":"<p>Commands matching <code>manual_approve</code> patterns require human approval. Note that <code>auto_approve</code> patterns are checked first\u2014if a command matches an auto-approve pattern, it runs without checking manual_approve.</p> <pre><code>hostexec:\n  manual_approve:\n    - pattern: \"^rm -rf\"\n    - pattern: \"^chmod -R 777\"\n</code></pre> <p>Commands not matching any pattern are denied by default.</p>"},{"location":"host-commands/#common-use-cases","title":"Common Use Cases","text":""},{"location":"host-commands/#git-push","title":"Git Push","text":"<pre><code>cloister@container:/work$ hostexec git push origin feature-branch\n</code></pre> <p>Git credentials are on the host, so push must go through hostexec.</p>"},{"location":"host-commands/#docker-commands","title":"Docker Commands","text":"<pre><code>cloister@container:/work$ hostexec docker compose up -d\ncloister@container:/work$ hostexec docker compose logs api\n</code></pre> <p>Docker socket isn't in the container; docker commands run on host.</p>"},{"location":"host-commands/#package-managers-host-level","title":"Package Managers (Host-level)","text":"<pre><code>cloister@container:/work$ hostexec brew install jq\n</code></pre> <p>Installing tools on the host (not in container).</p>"},{"location":"host-commands/#execution-context","title":"Execution Context","text":"<p>Host commands run: - In the project's worktree directory on the host - With the host user's environment - With access to host credentials and tools</p>"},{"location":"host-commands/#timeouts","title":"Timeouts","text":"<p>Hostexec requests timeout after 5 minutes of waiting for approval. The AI agent receives a timeout error.</p>"},{"location":"host-commands/#security-considerations","title":"Security Considerations","text":"<ul> <li>Commands execute with your host user's full permissions</li> <li>Review requests carefully, especially:</li> <li>Commands with pipes or redirects</li> <li>Commands accessing files outside the project</li> <li>Network-related commands (curl, wget)</li> </ul>"},{"location":"host-commands/#troubleshooting","title":"Troubleshooting","text":""},{"location":"host-commands/#request-not-appearing-in-ui","title":"Request not appearing in UI","text":"<ol> <li>Verify guardian is running: <code>cloister guardian status</code></li> <li>Check the cloister token is registered</li> <li>Ensure you're using <code>hostexec</code>, not running directly</li> </ol>"},{"location":"host-commands/#command-denied-unexpectedly","title":"Command denied unexpectedly","text":"<p>Commands not matching any pattern are denied. Check your config:</p> <pre><code>cloister config show\n</code></pre>"},{"location":"host-commands/#slow-approval","title":"Slow approval","text":"<p>If the UI is slow to update, check browser console for SSE connection issues. Refresh the page if needed.</p>"},{"location":"host-commands/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration \u2014 Setting up patterns</li> <li>Command Reference \u2014 Full CLI documentation</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>Common issues and solutions when using Cloister.</p>"},{"location":"troubleshooting/#installation-issues","title":"Installation Issues","text":""},{"location":"troubleshooting/#cloister-command-not-found-after-install","title":"\"cloister: command not found\" after install","text":"<p>The install directory (<code>~/.local/bin</code>) is not in your PATH.</p> <p>Solution:</p> <p>Add to your shell configuration:</p> <pre><code># bash (~/.bashrc or ~/.bash_profile)\nexport PATH=\"$HOME/.local/bin:$PATH\"\n\n# zsh (~/.zshrc)\nexport PATH=\"$HOME/.local/bin:$PATH\"\n\n# fish (~/.config/fish/config.fish)\nfish_add_path ~/.local/bin\n</code></pre> <p>Then restart your shell or run <code>source ~/.bashrc</code> (or equivalent).</p>"},{"location":"troubleshooting/#download-failed-during-install","title":"Download failed during install","text":"<p>The install script couldn't reach GitHub.</p> <p>Solutions: - Check your internet connection - If behind a proxy, ensure <code>curl</code> is configured to use it - Download manually from GitHub Releases</p>"},{"location":"troubleshooting/#docker-command-not-found","title":"\"docker: command not found\"","text":"<p>Docker is not installed.</p> <p>Solution: - macOS: Install Docker Desktop or OrbStack - Linux: Install Docker Engine per official docs</p>"},{"location":"troubleshooting/#startup-issues","title":"Startup Issues","text":""},{"location":"troubleshooting/#cannot-connect-to-the-docker-daemon","title":"\"Cannot connect to the Docker daemon\"","text":"<p>Docker is installed but not running.</p> <p>Solution: <pre><code># Linux\nsudo systemctl start docker\n\n# macOS\n# Open Docker Desktop or OrbStack application\n</code></pre></p>"},{"location":"troubleshooting/#guardian-failed-to-start","title":"\"Guardian failed to start\"","text":"<p>The guardian container couldn't be created.</p> <p>Check: 1. Docker is running: <code>docker info</code> 2. Ports aren't in use: <code>lsof -i :9997</code> and <code>lsof -i :9999</code> 3. Network exists: <code>docker network ls | grep cloister</code></p> <p>Reset if needed: <pre><code>docker rm -f cloister-guardian\ndocker network rm cloister-net\ncloister guardian start\n</code></pre></p>"},{"location":"troubleshooting/#project-not-detected","title":"\"Project not detected\"","text":"<p>Not in a git repository, or git isn't initialized.</p> <p>Solution: <pre><code># Initialize git if needed\ngit init\n\n# Then try again\ncloister start\n</code></pre></p>"},{"location":"troubleshooting/#network-issues","title":"Network Issues","text":""},{"location":"troubleshooting/#domain-not-in-allowlist","title":"\"Domain not in allowlist\"","text":"<p>The container tried to reach a domain that isn't allowed.</p> <p>Solutions:</p> <ol> <li> <p>Add to project config:    <pre><code># ~/.config/cloister/projects/my-app.yaml\nproxy:\n  allow:\n    - domain: docs.example.com\n</code></pre></p> </li> <li> <p>Add to global config for all projects:    <pre><code># ~/.config/cloister/config.yaml\nproxy:\n  allow:\n    - domain: docs.example.com\n</code></pre></p> </li> <li> <p>Enable approval mode for unlisted domains:    <pre><code># ~/.config/cloister/config.yaml\nproxy:\n  unlisted_domain_behavior: request_approval\n</code></pre></p> </li> <li> <p>Domains approved via the web UI are stored in <code>~/.config/cloister/decisions/</code> and merged automatically with static config. Check these files if a previously-approved domain stops working.</p> </li> </ol>"},{"location":"troubleshooting/#connection-refused-inside-container","title":"\"Connection refused\" inside container","text":"<p>Proxy isn't reachable.</p> <p>Check: <pre><code># Inside cloister\necho $HTTPS_PROXY\n# Should show http://token:TOKEN@cloister-guardian:3128\n\n# Test proxy connectivity\ncurl -v https://api.anthropic.com/v1/models\n</code></pre></p> <p>If proxy URL is empty: Container wasn't started correctly. Exit and restart: <pre><code>exit\ncloister stop\ncloister start\n</code></pre></p>"},{"location":"troubleshooting/#package-installation-fails","title":"Package installation fails","text":"<p>The package registry domain might not be allowlisted.</p> <p>Common registries to allowlist: <pre><code>proxy:\n  allow:\n    # npm\n    - domain: registry.npmjs.org\n    - domain: registry.yarnpkg.com\n\n    # Python\n    - domain: pypi.org\n    - domain: files.pythonhosted.org\n\n    # Go\n    - domain: proxy.golang.org\n    - domain: sum.golang.org\n\n    # Rust\n    - domain: crates.io\n    - domain: static.crates.io\n</code></pre></p>"},{"location":"troubleshooting/#credential-issues","title":"Credential Issues","text":""},{"location":"troubleshooting/#claude-prompts-for-login-inside-container","title":"Claude: Prompts for login inside container","text":"<p>Credentials weren't injected properly.</p> <p>Solution: 1. Re-run setup: <code>cloister setup claude</code> 2. Restart the cloister:    <pre><code>cloister stop\ncloister start\n</code></pre></p>"},{"location":"troubleshooting/#claude-authentication-failed","title":"Claude: \"Authentication failed\"","text":"<p>Token may have expired.</p> <p>Solution: 1. Get a fresh token:    <pre><code>claude setup-token\n</code></pre> 2. Update Cloister:    <pre><code>cloister setup claude\n</code></pre> 3. Restart the cloister</p>"},{"location":"troubleshooting/#claude-oauth-token-expired","title":"Claude: OAuth token expired","text":"<p>OAuth tokens last about a year. If expired:</p> <pre><code>claude setup-token  # Get new token (Claude Code CLI command)\ncloister setup claude  # Update config\ncloister stop &amp;&amp; cloister start  # Restart\n</code></pre>"},{"location":"troubleshooting/#codex-prompts-for-api-key-inside-container","title":"Codex: Prompts for API key inside container","text":"<p>Credentials weren't injected properly.</p> <p>Solution: 1. Re-run setup: <code>cloister setup codex</code> 2. Restart the cloister:    <pre><code>cloister stop\ncloister start\n</code></pre></p>"},{"location":"troubleshooting/#codex-authentication-failed","title":"Codex: \"Authentication failed\"","text":"<p>API key may be invalid or revoked.</p> <p>Solution: 1. Verify key at platform.openai.com/api-keys 2. Update Cloister:    <pre><code>cloister setup codex\n</code></pre> 3. Restart the cloister</p>"},{"location":"troubleshooting/#hostexec-issues","title":"Hostexec Issues","text":""},{"location":"troubleshooting/#request-not-appearing-in-approval-ui","title":"Request not appearing in approval UI","text":"<p>Check: 1. Guardian is running: <code>cloister guardian status</code> 2. UI is accessible: Open http://localhost:9999 3. Browser console for errors (SSE connection issues)</p> <p>Try: - Refresh the approval UI page - Restart guardian: <code>cloister guardian stop &amp;&amp; cloister guardian start</code></p>"},{"location":"troubleshooting/#command-denied-unexpectedly","title":"Command denied unexpectedly","text":"<p>Commands not matching any pattern are denied by default.</p> <p>Check patterns: <pre><code>cloister config show\n</code></pre></p> <p>Look at <code>hostexec.auto_approve</code> and <code>hostexec.manual_approve</code> patterns.</p>"},{"location":"troubleshooting/#hostexec-timeout","title":"Hostexec timeout","text":"<p>Requests timeout after 5 minutes without approval.</p> <p>Solutions: - Approve faster - Add frequently-used commands to auto-approve:   <pre><code>hostexec:\n  auto_approve:\n    - pattern: \"^git push origin\"\n</code></pre></p>"},{"location":"troubleshooting/#container-issues","title":"Container Issues","text":""},{"location":"troubleshooting/#container-wont-start","title":"Container won't start","text":"<p>Check Docker logs: <pre><code>docker logs cloister-my-app\n</code></pre></p> <p>Common causes: - Port conflict - Volume mount failure - Image not found</p> <p>Reset: <pre><code>cloister stop my-app\ndocker rm -f cloister-my-app  # Force remove if needed\ncloister start\n</code></pre></p>"},{"location":"troubleshooting/#files-missing-in-work","title":"Files missing in /work","text":"<p>Bind mount may have failed.</p> <p>Verify mount: <pre><code># Inside cloister\nmount | grep /work\n</code></pre></p> <p>If empty: Container needs restart with correct mount.</p>"},{"location":"troubleshooting/#permission-denied-on-files","title":"Permission denied on files","text":"<p>Container user may differ from host user.</p> <p>Check: <pre><code># Inside cloister\nid\nls -la /work\n</code></pre></p>"},{"location":"troubleshooting/#performance-issues","title":"Performance Issues","text":""},{"location":"troubleshooting/#slow-container-startup","title":"Slow container startup","text":"<p>First run downloads the image. Subsequent starts should be faster.</p> <p>Check image exists: <pre><code>docker images | grep cloister\n</code></pre></p>"},{"location":"troubleshooting/#slow-network-inside-container","title":"Slow network inside container","text":"<p>Proxy overhead is minimal but DNS resolution may add latency.</p>"},{"location":"troubleshooting/#getting-help","title":"Getting Help","text":""},{"location":"troubleshooting/#checking-versions","title":"Checking versions","text":"<pre><code>cloister --version\ndocker --version\ngo version\n</code></pre>"},{"location":"troubleshooting/#reporting-issues","title":"Reporting issues","text":"<ul> <li>GitHub Issues \u2014 Report bugs and request features</li> <li>GitHub Discussions \u2014 Ask questions and share tips</li> </ul> <p>When filing an issue, include: - Cloister version - OS and Docker version - Steps to reproduce - Error messages - Relevant config (redact credentials)</p>"},{"location":"troubleshooting/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration \u2014 Config file reference</li> <li>Command Reference \u2014 All CLI commands</li> </ul>"},{"location":"working-with-cloisters/","title":"Working with Cloisters","text":"<p>A cloister is a Docker container running on an isolated network with your project mounted at <code>/work</code>. This guide covers managing cloister lifecycle and workflows.</p>"},{"location":"working-with-cloisters/#starting-a-cloister","title":"Starting a Cloister","text":"<p>From any git repository:</p> <pre><code>cd ~/projects/my-app\ncloister start\n</code></pre> <p>This creates (or enters) a cloister and drops you into an interactive shell.</p>"},{"location":"working-with-cloisters/#entering-a-running-cloister","title":"Entering a Running Cloister","text":"<pre><code># From the project directory\ncloister start\n</code></pre> <p>If the cloister is already running, this opens a new shell session inside it.</p>"},{"location":"working-with-cloisters/#listing-cloisters","title":"Listing Cloisters","text":"<pre><code>cloister list\n</code></pre> <p>Output: <pre><code>NAME      PROJECT    BRANCH    UPTIME    STATUS\nmy-app    my-app     main      2h 15m    running\nfrontend  frontend   dev       45m       running\n</code></pre></p>"},{"location":"working-with-cloisters/#stopping-cloisters","title":"Stopping Cloisters","text":"<pre><code># Stop cloister for current directory\ncloister stop\n\n# Stop by name\ncloister stop my-app\n</code></pre> <p>Stopping removes the container. Your project files (in <code>/work</code>) are unaffected since they're bind-mounted from the host.</p>"},{"location":"working-with-cloisters/#the-container-environment","title":"The Container Environment","text":"<p>Inside a cloister, the environment is configured for sandboxed development:</p>"},{"location":"working-with-cloisters/#working-directory","title":"Working Directory","text":"<p>Your project is mounted at <code>/work</code>:</p> <pre><code>cloister@container:/work$ pwd\n/work\ncloister@container:/work$ ls\nREADME.md  src/  go.mod  ...\n</code></pre>"},{"location":"working-with-cloisters/#proxy-configuration","title":"Proxy Configuration","text":"<p>Network traffic routes through the guardian proxy:</p> <pre><code>cloister@container:/work$ echo $HTTPS_PROXY\nhttp://token:TOKEN@cloister-guardian:3128\n</code></pre> <p>Programs respecting <code>HTTPS_PROXY</code> automatically use the allowlisted proxy.</p>"},{"location":"working-with-cloisters/#pre-installed-tools","title":"Pre-installed Tools","text":"<p>The default container image includes: - Go, Node.js, Python - Git, curl, common CLI tools - AI agents: Claude Code, Codex CLI (configured with your credentials)</p>"},{"location":"working-with-cloisters/#managing-the-guardian","title":"Managing the Guardian","text":"<p>The guardian is a background service handling the proxy and approval UI.</p> <pre><code># Check guardian status\ncloister guardian status\n\n# Manually start (usually auto-starts)\ncloister guardian start\n\n# Stop guardian (also stops all cloisters)\ncloister guardian stop\n</code></pre>"},{"location":"working-with-cloisters/#multiple-cloisters","title":"Multiple Cloisters","text":"<p>You can run multiple cloisters simultaneously \u2014 each is an independent container.</p> <pre><code># Terminal 1\ncd ~/projects/api\ncloister start\n\n# Terminal 2\ncd ~/projects/frontend\ncloister start\n\n# List both\ncloister list\n</code></pre> <p>Each cloister: - Has its own shell sessions - Uses the shared guardian proxy - Can have different project configurations</p>"},{"location":"working-with-cloisters/#project-detection","title":"Project Detection","text":"<p>Cloister auto-detects projects from the git repository:</p> <pre><code>cd ~/projects/my-app\ncloister start\n# Creates cloister named \"my-app\" (from directory basename)\n</code></pre> <p>Projects are registered in <code>~/.config/cloister/projects.yaml</code>.</p>"},{"location":"working-with-cloisters/#managing-projects","title":"Managing Projects","text":"<pre><code># List registered projects\ncloister project list\n\n# Show project details\ncloister project show my-app\n\n# Edit project config\ncloister project edit my-app\n\n# Remove project registration\ncloister project remove my-app\n</code></pre>"},{"location":"working-with-cloisters/#next-steps","title":"Next Steps","text":"<ul> <li>Host Commands \u2014 Running commands outside the container</li> <li>Configuration \u2014 Per-project settings</li> <li>Troubleshooting \u2014 Common issues</li> </ul>"}]}