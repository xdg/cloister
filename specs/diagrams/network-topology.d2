# Multi-Cloister Network Topology

host: Host {
  label.near: bottom-center
  style.fill: "#e8f8e8"
  style.stroke: "#4a4"

  cloister_cli: "cloister binary" {
    style.fill: "#d8f0d8"
  }

  tcp_server: "TCP Server\n127.0.0.1:<port>" {
    style.fill: "#fff"
    style.stroke: "#888"
    style.stroke-dash: 3
  }

  browser: "Browser\n(approval UI)"

  cloister_cli -> tcp_server: listens
}

cloister_net: cloister-net (--internal) {
  style.fill: "#e8f4f8"
  style.stroke: "#68b"

  cloister_a: my-api-main
  cloister_b: frontend-main
  cloister_c: shared-lib-feature
}

guardian: cloister-guardian {
  label.near: bottom-center
  style.fill: "#f8f4e8"
  style.stroke: "#a84"

  proxy: "Proxy\n:3128" {
    style.fill: "#fff8e8"
  }
  request: "Request Server\n:9998" {
    style.fill: "#fff8e8"
  }
  approval: "Approval UI\n:9999" {
    style.fill: "#fff"
    style.stroke: "#888"
  }
}

bridge: bridge network {
  style.fill: "#f4e8f8"
  style.stroke: "#a4a"
}

internet: Internet {
  style.fill: "#f0e0f0"
  style.stroke: "#a4a"
}

# Cloister containers -> Guardian (on cloister-net)
cloister_net -> guardian.proxy: HTTP CONNECT {
  style.stroke: "#68b"
}
cloister_net -> guardian.request: hostexec requests {
  style.stroke: "#68b"
}

# Guardian -> Internet (via bridge)
guardian.proxy -> bridge
bridge -> internet: allowlisted traffic

# Host command execution via TCP (host.docker.internal)
guardian.request -> host.tcp_server {
  style.stroke: "#4a4"
}

# Approval UI exposed to host
host.browser -> guardian.approval {
  style.stroke: "#888"
}

# vim: set ts=2 sts=2 sw=2 et tw=75:
